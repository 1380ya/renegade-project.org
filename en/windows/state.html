<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="description" content="Windows Status Matrix" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0" />
		<link rel="stylesheet" href="/res/vue.css" />
		<title>Windows Status Matrix</title>
		<style>
			td.state-y,td.state-n,td.state-p,td.state-w,td.state-t,td.state-u{
				text-align:center;
			}
			td.state-y{background-color:#CFFFBF;}
			td.state-n{background-color:#FF6060;}
			td.state-p{background-color:yellow;}
			td.state-w{background-color:#8080FF;}
			td.state-t{background-color:#E000E0;}
			td.state-u{background-color:#A0A0A0;}
			th{
				padding-left:5px;
				padding-right:5px;
				white-space:nowrap;
			}
			body{
				overflow:auto !important;
			}
			.markdown-section{
				max-width:100%;
			}
		</style>
		<script>
			let num=0;
			let messages=[];
			function add_device(device){
				const cont=document.getElementById("content");
				const add_col=function(_tr,_content,_class){
					const td=document.createElement("td");
					if(_class)td.setAttribute("class",_class);
					td.innerText=_content;
					_tr.appendChild(td);
					return td;
				};
				const add_state=function(_tr,_state,_default,_message){
					const state=_state?_state:_default;
					const c=add_col(
						tr,
						state.toUpperCase(),
						"state-"+state.toLowerCase()
					);
					if(_message){
						let msg=null;
						let id=-1;
						let str=_message.en_us;
						for(let i=0;i<messages.length;i++){
							if(str!==messages[i].str)continue;
							msg=messages[i];
							id=msg.id;
						}
						if(id<0)id=++num;
						let x=document.createElement("sup");
						x.innerText=id.toString();
						c.number=id;
						c.appendChild(x);
						c.style.cursor="pointer";
						c.onclick=function(){
							const note=document.getElementById("note-"+this.number);
							const notes=note.style;
							if(parent)parent.scrollTo(0,note.offsetTop);
							else scrollTo(0,note.offsetTop);
							notes.backgroundColor="gray";
							setTimeout(function(){notes.backgroundColor=null},250);
                                                };
						if(!msg){
							let m=document.createElement("li");
							m.id="note-"+id;
							m.innerText=id+": "+str;
							document.getElementById("messages").appendChild(m);
							document.getElementById("message").style.display=null;
							messages.push({id:id,str:str});
						}
					}
				};
				const tr=document.createElement("tr");
				let state=device.state,message=device.message;
				if(!state)state={};
				if(!message)message={};
				add_col(tr,device.name.en_us,null);
				add_col(tr,device.codename,null);
				cont.appendChild(tr);
				add_state(tr,state.uefi          ,"y",message.uefi);
				add_state(tr,state.windowspe     ,"y",message.windowspe);
				add_state(tr,state.fullsystem    ,"u",message.fullsystem);
				add_state(tr,state.usb           ,"y",message.usb);
				add_state(tr,state.ufs           ,"y",message.ufs);
				add_state(tr,state.display       ,"y",message.display);
				add_state(tr,state.buttons       ,"y",message.buttons);
				add_state(tr,state.touchscreen   ,"u",message.touchscreen);
				add_state(tr,state.wifi          ,"w",message.wifi);
				add_state(tr,state.bluetooth     ,"w",message.bluetooth);
				add_state(tr,state.battery       ,"w",message.battery);
				add_state(tr,state.charging      ,"w",message.charging);
				add_state(tr,state.virtualization,"n",message.virtualization);
				add_state(tr,state.gpu           ,"t",message.gpu);
				add_state(tr,state.lte           ,"t",message.lte);
				add_state(tr,state.call          ,"t",message.call);
				add_state(tr,state.sms           ,"t",message.sms);
				add_state(tr,state.gps           ,"t",message.gps);
				add_state(tr,state.audio         ,"t",message.audio);
				add_state(tr,state.sensor        ,"t",message.sensor);
				add_state(tr,state.camera        ,"t",message.camera);
			}
			function update_size(){
				if(!parent)return;
				const i=parent.document.getElementById("iframe");
				if(!i)return;
				i.height=document.body.scrollHeight;
			}
			function initialize(){
				const cont=document.getElementById("content");
				cont.innerText="Loading...";
				try{
					let x;
					if(window.XMLHttpRequest)x=new XMLHttpRequest();
					else x=new ActiveXObject("Microsoft.XMLHTTP");
					x.open("GET","/devices.json",true);
					x.onreadystatechange=function(){
						try{
							if(x.readyState!==4)return;
							if(x.status!==200)throw new Error("status not ok: "+x.status);
							const j=JSON.parse(x.response);
							cont.innerHTML="";
							for(let i=0;i<j.length;i++)add_device(j[i]);
							update_size();
						}catch(e){
							cont.innerText="Load failed: "+e;
							console.error(e);
						}
					}
					x.send();
				}catch(e){
					cont.innerText="Load failed: "+e;
					console.error(e);
				}
			}
		</script>
	</head>
	<body class="markdown-section">
		<h2>Windows Status Matrix</h2>
		<table border="1" cellspacing="0">
			<thead>
				<tr>
					<th>Device</th>
					<th>CodeName</th>
					<th>UEFI</th>
					<th>PE</th>
					<th>Full System</th>
					<th>USB</th>
					<th>UFS</th>
					<th>Display</th>
					<th>Buttons</th>
					<th>TouchScreen</th>
					<th>WiFi</th>
					<th>Bluetooth</th>
					<th>Battery</th>
					<th>Charge</th>
					<th>Virtualization</th>
					<th>GPU</th>
					<th>LTE</th>
					<th>Call</th>
					<th>SMS</th>
					<th>Location</th>
					<th>Audio</th>
					<th>Sensors</th>
					<th>Camera</th>
				</tr>
			</thead>
			<tbody id="content">
			</tbody>
		</table>
		<br/>
		<table>
			<tbody>
				<tr>
					<td class="state-y">Y</td>
					<td>Already supported and available</td>
				</tr>
				<tr>
					<td class="state-n">N</td>
					<td>Currently impossible to be supported</td>
				</tr>
				<tr>
					<td class="state-p">P</td>
					<td>Problematic, might be supported but not necessarily available</td>
				</tr>
				<tr>
					<td class="state-w">W</td>
					<td>Tested on other devices, not verified to be working on this device</td>
				</tr>
				<tr>
					<td class="state-t">T</td>
					<td>Will get supported hopefully, under testing or being ported</td>
				</tr>
				<tr>
					<td class="state-u">U</td>
					<td>Unknown status</td>
				</tr>
			</tbody>
		</table>
		<p>The status of some devices may be missing in this table, please add them to <a href="https://github.com/edk2-porting/renegade-project.org">GitHub</a>.</p>
		<div id="message" style="display:none">
			<p>Notes: </p>
			<ul id="messages"></ul>
		</div>
	</body>
	<script>initialize();</script>
</html>
